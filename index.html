<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Recast — Executive Click-Through (Polished UX)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="dark">
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    :root{
      --bg:#0d141a; --surface:#131c23; --muted:#c7d0d9; --muted2:#98a5b3; --text:#f7fafc; --accent:#3abff8; --icon:#6b7785; --pink:#ff57c9; --success:#22c55e;
    }
    html,body{background: radial-gradient(1200px 700px at 20% -10%, #14212b 0%, var(--bg) 60%) fixed; color:var(--text);}
    @keyframes fadeInUp { from { opacity:.0; transform: translateY(8px); } to { opacity:1; transform: translateY(0); } }
  </style>
</head>
<body class="min-h-screen antialiased selection:bg-sky-300/20" style="font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;">
  <div id="app" class="min-h-screen"></div>

  <script>
    // ---- Brand + constants ---------------------------------------------------
    const BRAND = {
      bg: 'var(--bg)',
      surface: 'var(--surface)',
      accent: 'var(--accent)',
      text: 'var(--text)',
      muted: 'var(--muted)',
      muted2: 'var(--muted2)',
      icon: 'var(--icon)',
      pink: 'var(--pink)',
      success: 'var(--success)'
    };
    const CATALOG = { countLabel: "7,000+ curated titles", asOf: "Apr 2025" };
    const SESSION_ID = Math.random().toString(36).slice(2);

    // ---- App state -----------------------------------------------------------
    const STATE = {
      activeTab: 'problems',
      // Context toggles for routing demo
      ctx: { device: 'Windows', network: 'Corporate', compliant: true },
      packHrs: 8,
      configHrs: 2,
      currentHrs: 24,
      // ROI calculator
      roi: {
        appsInScope: 120,
        avgUpdatesPerAppPerMonth: 2,
        currentHrsPerPackage: 2.5,
        recastHrsPerCuratedUpdate: 0.25,
        loadedHourlyRate: 85,
        criticalCVEsPerYear: 6,
        currentDaysToPatchCritical: 9,
        withRingsDaysToPatch: 3,
        auditHoursPerQuarter: 8,
        withRecastAuditHoursPerQuarter: 0.75,
        recastAnnualCost: 120000,
        realizationPct: 85,
        monthsToValue: 12
      },
      copied: false
    };

    const TABS = [
      { id: 'problems', label: 'Current Problems', icon: 'alert-triangle' },
      { id: 'solution', label: 'How We Solve It', icon: 'workflow' },
      { id: 'roi', label: 'Impact & ROI', icon: 'bar-chart-3' }
    ];

    // ---- Utilities -----------------------------------------------------------
    function track(event, payload = {}) {
      window.__recastAnalytics = window.__recastAnalytics || [];
      window.__recastAnalytics.push({ ts: Date.now(), sid: SESSION_ID, event, payload });
      try { console.log('[analytics]', event, payload); } catch {}
    }
    function cx(...a){ return a.filter(Boolean).join(' '); }
    function round(n, d=2){ const m = Math.pow(10,d); return Math.round((Number(n)||0) * m) / m; }
    function num(n){ return new Intl.NumberFormat().format(Math.round(Number(n)||0)); }
    function num2(n, d=2){ return Number(n||0).toLocaleString(undefined,{minimumFractionDigits:d, maximumFractionDigits:d}); }
    function clampNonNeg(n){ return Math.max(0, Number(n) || 0); }
    function routeRecommendation(ctx){
      if(!ctx.compliant) return 'Web';
      if(ctx.device === 'Windows' && ctx.network !== 'Home') return 'Local';
      return 'VDI';
    }
    function routeWhy(ctx){
      const reasons = [];
      reasons.push(`User/Group: Azure AD targeting`);
      reasons.push(`Device trust: ${ctx.compliant ? "Compliant" : "Non-compliant"}`);
      reasons.push(`Session/Broker: ${ctx.network!=="Home" ? "Broker available" : "Home network"}`);
      return `Decision factors → ${reasons.join(" • ")}`;
    }
    function focusRing(extra=''){
      return cx(
        'focus-visible:outline-none',
        'focus-visible:ring-2',
        'focus-visible:ring-offset-2',
        `focus-visible:ring-[${BRAND.accent}]`,
        `focus-visible:ring-offset-[${BRAND.bg}]`,
        extra
      );
    }

    // ---- Render root ---------------------------------------------------------
    function render() {
      const root = document.getElementById('app');
      root.innerHTML = `
        <header class="relative">
          <div class="relative mx-auto max-w-7xl px-5 pt-14 pb-8">
            <div class="opacity-0 translate-y-2 animate-[fadeInUp_.35s_ease_forwards]">
              <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight leading-tight">
                Define apps once. Deliver everywhere—with evidence.
              </h1>
              <div class="mt-3 inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs text-[${BRAND.muted}]">
                <i data-lucide="library" class="w-3.5 h-3.5 text-[${BRAND.icon}]"></i>
                <span id="catalog-chip">${CATALOG.countLabel}</span>
                <span class="opacity-70">(as of ${CATALOG.asOf})</span>
              </div>
              <p class="mt-3 max-w-3xl text-[${BRAND.muted}]">From fragmented delivery to consistent outcomes leaders can trust.</p>
            </div>
          </div>
        </header>

        <main class="mx-auto max-w-7xl px-5 pb-24">
          ${renderTabs()}
          <section class="mt-8">${renderActivePanel()}</section>
        </main>
      `;
      if (window.lucide && window.lucide.createIcons) {
        try { window.lucide.createIcons(); } catch {}
      }
      attachGlobalEvents();
    }

    function renderTabs() {
      return `
        <nav role="tablist" aria-label="Sections" class="flex w-full flex-wrap gap-2 rounded-2xl bg-white/5 p-1 ring-1 ring-white/10">
          ${TABS.map(t => `
            <button
              type="button"
              class="${
                cx(
                  'group relative inline-flex items-center gap-2 rounded-xl px-4 py-2 text-sm sm:text-base transition',
                  focusRing(),
                  STATE.activeTab === t.id
                    ? 'bg-[${BRAND.accent}] text-white'
                    : 'text-[${BRAND.muted}] hover:bg-white/10'
                )
              }"
              role="tab"
              id="tab-${t.id}"
              aria-selected="${STATE.activeTab === t.id}"
              aria-controls="panel-${t.id}"
              data-action="switch-tab"
              data-tab="${t.id}"
            >
              <i data-lucide="${t.icon}" class="w-4 h-4 text-[${BRAND.icon}]" aria-hidden="true"></i>
              <span>${t.label}</span>
            </button>
          `).join('')}
        </nav>
      `;
    }

    function renderActivePanel(){
      if (STATE.activeTab === 'problems') return renderProblems();
      if (STATE.activeTab === 'solution') return renderSolution();
      if (STATE.activeTab === 'roi') return renderROI();
      return '';
    }

    // ---- Problems (polished, exec-friendly) ---------------------------------
    function statCard({icon,label,value,foot=''}) {
      return `
        <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-white">${label}</span>
            <i data-lucide="${icon}" class="w-4 h-4 text-[${BRAND.icon}]"></i>
          </div>
          <div class="mt-3 text-3xl font-semibold tracking-tight">${value}</div>
          ${foot ? `<p class="mt-1 text-xs text-[${BRAND.muted}]">${foot}</p>`:''}
        </div>
      `;
    }

    function renderProblems(){
      const r = STATE.roi;
      const packagingHoursSavedPerMonth = clampNonNeg(r.appsInScope * r.avgUpdatesPerAppPerMonth * (r.currentHrsPerPackage - r.recastHrsPerCuratedUpdate));
      const zeroDayHoursReducedPerIncident = clampNonNeg((r.currentDaysToPatchCritical - r.withRingsDaysToPatch) * 24);

      const problemCards = [
        {title:'Fragmented delivery', sub:'Windows / Mac / VDI / Web — users guess the right way.', icon:'layers'},
        {title:'Packaging backlog', sub:'Rebuild per version; updates stall.', icon:'package'},
        {title:'Zero-day exposure', sub:'Patching takes days, not minutes.', icon:'shield-alert'},
        {title:'Slow upgrades', sub:'Stuck to old images; change is slow.', icon:'calendar-clock'}
      ];

      const valueCards = [
        {
          title:'Audit & compliance',
          icon:'file-search',
          bullets:[
            'Staged rollouts with approvals',
            'Immutable audit trails & export',
            'Policy compliance visibility'
          ]
        },
        {
          title:'Catalog depth (pre-packaged)',
          icon:'boxes',
          bullets:[
            `${CATALOG.countLabel} (as of ${CATALOG.asOf})`,
            'Curated, secure defaults',
            'Less scripting; faster deployment'
          ]
        },
        {
          title:'Integration ecosystem',
          icon:'workflow',
          bullets:[
            'Bridge across Intune & ConfigMgr',
            'Works with Citrix, VMware, AVD',
            'Use existing infra — no agent sprawl'
          ]
        },
        {
          title:'Day-one productivity',
          icon:'rocket',
          bullets:[
            'New users get apps on first login',
            'SSO + self-service catalog',
            'Faster onboarding, happier employees'
          ]
        }
      ];

      return `
        <section role="tabpanel" id="panel-problems" aria-labelledby="tab-problems" class="space-y-8">
          <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
            ${statCard({icon:'sparkles', label:'Minutes saved (per user)', value:num(9)})}
            ${statCard({icon:'wrench', label:'Packaging hours avoided (per month)', value:num(round(packagingHoursSavedPerMonth,1))})}
            ${statCard({icon:'alarm-clock', label:'Zero-day window reduced (hrs)', value:num(round(zeroDayHoursReducedPerIncident,0)), foot:'Per critical CVE incident'})}
          </div>

          <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
            ${problemCards.map(p=>`
              <article class="rounded-2xl border border-white/10 bg-white/5 p-5">
                <div class="flex items-center gap-2">
                  <i data-lucide="${p.icon}" class="w-5 h-5 text-[${BRAND.icon}]"></i>
                  <h3 class="text-base font-semibold text-white">${p.title}</h3>
                </div>
                <p class="mt-1 text-sm text-[${BRAND.muted}]">${p.sub}</p>
              </article>
            `).join('')}
          </div>

          <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
            <h3 class="text-base font-semibold text-white">What good looks like with Application Workspace</h3>
            <ul class="mt-2 grid grid-cols-1 gap-2 text-sm text-[${BRAND.muted}] sm:grid-cols-2">
              <li class="list-disc pl-5">Unified access: one workspace, any device.</li>
              <li class="list-disc pl-5">Configure once, deploy everywhere, patch automatically.</li>
              <li class="list-disc pl-5">Close zero-day windows in hours.</li>
              <li class="list-disc pl-5">Scale with curated apps, staged rollouts, and audit trails.</li>
              <li class="list-disc pl-5">Empower users with SSO and self-service.</li>
            </ul>
          </div>

          <div class="space-y-3">
            <h3 class="text-base font-semibold text-white">Value components (why customers choose Recast)</h3>
            <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
              ${valueCards.map(v=>`
                <article class="rounded-2xl border border-white/10 bg-white/5 p-5">
                  <div class="flex items-center gap-2">
                    <i data-lucide="${v.icon}" class="w-5 h-5 text-[${BRAND.icon}]"></i>
                    <h4 class="text-base font-semibold text-white">${v.title}</h4>
                  </div>
                  <ul class="mt-2 space-y-1 text-sm text-[${BRAND.muted}]">
                    ${v.bullets.map(b=>`<li class="list-disc pl-5">${b}</li>`).join('')}
                  </ul>
                </article>
              `).join('')}
            </div>
          </div>

          <div class="flex justify-end">
            <button
              type="button"
              data-action="advance"
              data-next="solution"
              class="inline-flex items-center gap-2 rounded-xl bg-[${BRAND.accent}] px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:brightness-110 ${focusRing()}"
            >
              How We Solve It
            </button>
          </div>
        </section>
      `;
    }

    // ---- Solution (cleaned, removed audit preview) ---------------------------
    function pill(label, active, action, value){
      return `
        <button
          type="button"
          class="${
            cx(
              'rounded-full px-3 py-1.5 border text-sm transition',
              active
                ? `bg-[${BRAND.accent}] text-white border-transparent`
                : 'bg-black/30 text-white/90 hover:bg-white/10 border-white/15',
              focusRing()
            )
          }"
          data-action="${action}"
          data-value="${String(value)}"
        >
          ${label}
        </button>
      `;
    }

    function renderSolution(){
      const saved = clampNonNeg(STATE.packHrs - STATE.configHrs);
      const target = 1.5;
      const reduced = clampNonNeg(STATE.currentHrs - target);
      const route = routeRecommendation(STATE.ctx);

      const ribbon = `
        <ol class="grid grid-cols-1 gap-2 sm:grid-cols-3">
          ${[
            {icon:"file-plus-2",label:"Define app"},
            {icon:"git-merge",label:"Choose rings"},
            {icon:"send",label:"Publish to Intune + ConfigMgr + Citrix/AVD"}
          ].map(s=>`
            <li class="group flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 p-3">
              <i data-lucide="${s.icon}" class="w-4 h-4 text-[${BRAND.icon}]"></i>
              <span class="text-sm text-white">${s.label}</span>
              <span class="ml-auto h-1 w-8 rounded bg-[${BRAND.accent}] opacity-0 group-hover:opacity-100"></span>
            </li>`).join("")}
        </ol>
      `;

      return `
        <section role="tabpanel" id="panel-solution" aria-labelledby="tab-solution" class="space-y-6">
          <p class="text-sm text-[${BRAND.muted}]">Simple operating model executives appreciate — minimal change for IT, maximum consistency for users.</p>
          ${ribbon}

          <div class="grid grid-cols-1 gap-5 md:grid-cols-3">
            <article class="rounded-2xl border border-white/10 bg-white/5 p-5">
              <div class="flex items-center gap-2">
                <i data-lucide="mouse-pointer-click" class="w-5 h-5 text-[${BRAND.icon}]"></i>
                <h3 class="text-lg font-semibold">One click. Right app.</h3>
              </div>
              <p class="mt-1 text-sm text-[${BRAND.muted}]">One icon for all apps. We route to the right experience (Windows, Mac, VPN, or Web).</p>
              <div class="mt-3 grid grid-cols-3 gap-2 text-sm">
                ${['Windows','Mac'].map(d=>pill(d, STATE.ctx.device===d, 'set-device', d)).join('')}
                ${['Corporate','VPN'].map(n=>pill(n, STATE.ctx.network===n, 'set-network', n)).join('')}
                ${pill(STATE.ctx.compliant?'Compliant':'Non-compliant', STATE.ctx.compliant, 'toggle-compliance', '')}
              </div>
              <div class="mt-3 text-sm text-[${BRAND.muted}]">Recommended route</div>
              <div class="inline-flex items-center gap-2 rounded-full bg-black/30 px-3 py-1.5 ring-1 ring-white/10">
                <i data-lucide="check-circle-2" class="w-4 h-4 text-[${BRAND.success}]"></i>
                <strong class="text-white text-sm">${route}</strong>
              </div>
              <button type="button"
                class="mt-3 inline-flex items-center gap-1 rounded-full border border-white/15 bg-black/30 px-2 py-1 text-xs text-[${BRAND.muted}] ${focusRing()}"
                aria-expanded="false" aria-controls="why-route" data-action="toggle-why">
                <i data-lucide="help-circle" class="w-3.5 h-3.5 text-[${BRAND.icon}]"></i> Why this route?
              </button>
              <div id="why-route" class="mt-2 hidden rounded-lg border border-white/10 bg-black/30 p-2 text-xs text-[${BRAND.muted}]">
                ${routeWhy(STATE.ctx)}
              </div>
            </article>

            <article class="rounded-2xl border border-white/10 bg-white/5 p-5">
              <div class="flex items-center gap-2">
                <i data-lucide="wand-2" class="w-5 h-5 text-[${BRAND.icon}]"></i>
                <h3 class="text-lg font-semibold">Update once. Done.</h3>
              </div>
              <p class="mt-1 text-sm text-[${BRAND.muted}]">Configure once; updates flow across tenants and environments—cloud, on-prem, hybrid.</p>
              <div class="mt-3 rounded-xl border border-white/10 bg-black/20 p-4 text-sm">
                <div class="flex items-center gap-2 font-medium text-white"><i data-lucide="sparkles" class="w-4 h-4 text-[${BRAND.icon}]"></i> Roll out critical updates</div>
                <label class="mt-2 flex items-center gap-2">
                  <span class="text-xs text-[${BRAND.muted}] w-44">Hours per package → configure</span>
                  <input aria-label="Hours per package" class="w-20 rounded bg-black/40 px-2 py-1 text-white placeholder-white/40 ${focusRing()}" inputmode="decimal" value="${STATE.packHrs}" data-action="set-pack-hrs">
                  <span aria-hidden="true">→</span>
                  <input aria-label="Hours to configure" class="w-20 rounded bg-black/40 px-2 py-1 text-white placeholder-white/40 ${focusRing()}" inputmode="decimal" value="${STATE.configHrs}" data-action="set-config-hrs">
                </label>
                <div class="mt-2 flex items-center justify-between rounded bg-black/30 px-3 py-2">
                  <span class="text-[${BRAND.muted}]">${STATE.packHrs} → ${STATE.configHrs} hrs</span>
                  <strong class="text-white">${saved} hrs saved</strong>
                </div>
              </div>
            </article>

            <article class="rounded-2xl border border-white/10 bg-white/5 p-5">
              <div class="flex items-center gap-2">
                <i data-lucide="shield-check" class="w-5 h-5 text-[${BRAND.icon}]"></i>
                <h3 class="text-lg font-semibold">Close zero-day windows.</h3>
              </div>
              <p class="mt-1 text-sm text-[${BRAND.muted}]">Security patches roll out in hours, reducing exposure windows.</p>
              <div class="mt-3 rounded-xl border border-white/10 bg-black/20 p-4 text-sm">
                <div class="flex items-center gap-2 font-medium text-white"><i data-lucide="alarm-clock" class="w-4 h-4 text-[${BRAND.icon}]"></i> Zero-day rollout</div>
                <label class="mt-2 flex flex-col gap-1">
                  <span class="text-xs text-[${BRAND.muted}]">Current time-to-deploy (hrs)</span>
                  <input class="rounded bg-black/40 px-2 py-1 text-white placeholder-white/40 ${focusRing()}" aria-label="Current time to deploy (hours)" inputmode="decimal" value="${STATE.currentHrs}" data-action="set-current-hrs">
                </label>
                <div class="mt-2 flex items-center justify-between rounded bg-black/30 px-3 py-2">
                  <span class="text-[${BRAND.muted}]">${STATE.currentHrs} → 1.5 hrs</span>
                  <strong class="text-white">${round(STATE.currentHrs - 1.5)} hrs reduced</strong>
                </div>
              </div>
            </article>
          </div>

          <div class="flex justify-end">
            <button type="button" data-action="advance" data-next="roi" class="inline-flex items-center gap-2 rounded-xl bg-[${BRAND.accent}] px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:brightness-110 ${focusRing()}">
              See Impact & ROI
            </button>
          </div>
        </section>
      `;
    }

    // ---- ROI (unchanged logic + polished totals + comparator) ----------------
    function kpi(icon,label,value,hint){
      return `
        <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-xs text-[${BRAND.muted}]">${label}</div>
              <div class="text-xl font-semibold">${value}</div>
            </div>
            <i data-lucide="${icon}" class="w-5 h-5 text-[${BRAND.icon}]"></i>
          </div>
          ${hint ? `<div class="mt-1 text-xs text-[${BRAND.muted}]">${hint}</div>` : ''}
        </div>
      `;
    }

    function numInput(label, key, value){
      return `
        <label class="flex flex-col gap-1">
          <span class="text-xs text-[${BRAND.muted}]">${label}</span>
          <input class="rounded-xl border border-white/10 bg-black/30 px-3 py-2 text-sm text-white placeholder-white/40 ${focusRing()}" inputmode="decimal" value="${value}" data-action="set-roi" data-key="${key}">
        </label>
      `;
    }

    function renderROI(){
      const r = STATE.roi;

      const packagingHoursSavedPerMonth = clampNonNeg(r.appsInScope * r.avgUpdatesPerAppPerMonth * (r.currentHrsPerPackage - r.recastHrsPerCuratedUpdate));
      const packagingLaborSavedPerMonthDollars = packagingHoursSavedPerMonth * clampNonNeg(r.loadedHourlyRate);

      const riskWindowReductionDaysPerYear = clampNonNeg(r.criticalCVEsPerYear * (r.currentDaysToPatchCritical - r.withRingsDaysToPatch));

      const auditHoursSavedPerYear = clampNonNeg((r.auditHoursPerQuarter - r.withRecastAuditHoursPerQuarter) * 4);
      const auditEffortAvoidedPerYearDollars = auditHoursSavedPerYear * clampNonNeg(r.loadedHourlyRate);

      const totalSavingsPerYear = (packagingLaborSavedPerMonthDollars * 12) + auditEffortAvoidedPerYearDollars;

      const prob = clampNonNeg(r.realizationPct ?? 100) / 100;
      const prorate = Math.min(12, Math.max(0, r.monthsToValue ?? 12)) / 12;
      const adjTotalSavingsPerYear = totalSavingsPerYear * prob * prorate;

      const netBenefitYear = adjTotalSavingsPerYear - clampNonNeg(r.recastAnnualCost);
      const roiPct = r.recastAnnualCost ? (netBenefitYear / r.recastAnnualCost) * 100 : 0;

      return `
        <section role="tabpanel" id="panel-roi" aria-labelledby="tab-roi" class="space-y-8">
          <div aria-live="polite">
            <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
              ${kpi('hammer','$ packaging labor saved / yr', `$${num(packagingLaborSavedPerMonthDollars * 12)}`, 'Apps × updates × (current − Recast) × rate')}
              ${kpi('timer','Packaging hours / mo saved', round(packagingHoursSavedPerMonth), 'Operational capacity')}
              ${kpi('shield','Risk window reduction / yr', `${round(riskWindowReductionDaysPerYear,1)} days`, 'Critical CVEs × (current − with rings)')}
              ${kpi('file-text','$ audit effort avoided / yr', `$${num(auditEffortAvoidedPerYearDollars)}`, `${num(auditHoursSavedPerYear)} hrs saved @ rate`)}
            </div>
          </div>

          <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
            <section class="rounded-2xl border border-white/10 bg-white/5 p-6 lg:col-span-2">
              <h3 class="text-lg font-semibold">Your numbers here (edit)</h3>

              <div class="mt-4 grid grid-cols-1 gap-6 md:grid-cols-2">
                <div class="space-y-3">
                  <h4 class="text-sm font-semibold">Packaging & updates</h4>
                  ${numInput('Apps in scope','appsInScope', r.appsInScope)}
                  ${numInput('Avg updates / app / month','avgUpdatesPerAppPerMonth', r.avgUpdatesPerAppPerMonth)}
                  ${numInput('Current hrs per package/update (default 2.5)','currentHrsPerPackage', r.currentHrsPerPackage)}
                  ${numInput('Recast hrs per curated update (default 0.25)','recastHrsPerCuratedUpdate', r.recastHrsPerCuratedUpdate)}
                </div>

                <div class="space-y-3">
                  <h4 class="text-sm font-semibold">Risk & audit</h4>
                  ${numInput('Critical CVEs / year','criticalCVEsPerYear', r.criticalCVEsPerYear)}
                  ${numInput('Current days to patch critical (default 9)','currentDaysToPatchCritical', r.currentDaysToPatchCritical)}
                  ${numInput('With rings: days to patch (default 3)','withRingsDaysToPatch', r.withRingsDaysToPatch)}
                  ${numInput('Audit hours / quarter compiling evidence (default 8)','auditHoursPerQuarter', r.auditHoursPerQuarter)}
                  ${numInput('With Recast: audit hours / quarter (default 0.75)','withRecastAuditHoursPerQuarter', r.withRecastAuditHoursPerQuarter)}
                </div>
              </div>

              <div class="mt-6 grid grid-cols-1 gap-6 md:grid-cols-2">
                <div class="space-y-3">
                  <h4 class="text-sm font-semibold">Cost model</h4>
                  ${numInput('Loaded hourly rate ($/hr) (default 85)','loadedHourlyRate', r.loadedHourlyRate)}
                  ${numInput('Recast annual cost ($)','recastAnnualCost', r.recastAnnualCost)}
                  ${numInput('Probability to realize (%)','realizationPct', r.realizationPct)}
                  ${numInput('Time-to-value (months, yr-1)','monthsToValue', r.monthsToValue)}
                </div>

                <div class="space-y-2 text-sm">
                  <div class="rounded-lg bg-black/30 px-3 py-2 flex items-center justify-between">
                    <span class="text-[${BRAND.muted}]">Total savings / year (adjusted)</span>
                    <strong class="text-white">$${num2(adjTotalSavingsPerYear,2)}</strong>
                  </div>
                  <div class="rounded-lg bg-black/30 px-3 py-2 flex items-center justify-between">
                    <span class="text-[${BRAND.muted}]">Net benefit / year</span>
                    <strong class="text-white">$${num2(netBenefitYear,2)}</strong>
                  </div>
                  <div class="rounded-lg bg-black/30 px-3 py-2 flex items-center justify-between">
                    <span class="text-[${BRAND.muted}]">ROI (adjusted)</span>
                    <strong class="text-white">${round(roiPct,1)}%</strong>
                  </div>
                </div>
              </div>

              <p class="mt-4 text-xs text-[${BRAND.muted}]">Assumptions reflect common enterprise environments and can be edited inline.</p>
            </section>

            <aside class="rounded-2xl border border-white/10 bg-white/5 p-6 space-y-3">
              <h3 class="text-lg font-semibold">Scope included in the model</h3>
              <ul class="list-disc pl-5 text-sm text-[${BRAND.muted}] space-y-1">
                <li>Catalog & packaging, lifecycle rings, cross-platform reach (Windows/macOS, VDI/DAAS).</li>
                <li>Governance & evidence with CVE mapping and ring reporting.</li>
                <li>Identity targeting, SSO, approvals, and Teams entry point.</li>
                <li>Integrations via APIs/PowerShell; reuse of Intune/ConfigMgr.</li>
                <li>Scale & reliability signals (catalog velocity, service health).</li>
              </ul>

              <div class="pt-2 border-t border-white/10">
                <h4 class="text-sm font-semibold">Copy summary</h4>
                <button type="button" data-action="copy-onepager" class="mt-2 inline-flex items-center gap-2 rounded-xl bg-[${BRAND.accent}] px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:brightness-110 ${focusRing()}">
                  <i data-lucide="clipboard" class="w-4 h-4 text-[${BRAND.icon}]"></i> ${STATE.copied ? 'Copied!' : 'Copy executive one-pager'}
                </button>
                <button type="button" data-action="reset-calculator" class="mt-2 inline-flex items-center gap-2 rounded-xl border border-[${BRAND.accent}] bg-transparent px-4 py-2 text-sm font-semibold text-[${BRAND.accent}] hover:bg-[${BRAND.accent}] hover:text-white transition ${focusRing()}">
                  Reset calculator
                </button>
              </div>
            </aside>
          </div>

          <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
            <h4 class="text-sm font-semibold">Status-quo (Do Nothing) cost</h4>
            <p class="mt-1 text-xs text-[${BRAND.muted}]">What you keep spending without Recast.</p>
            <div class="mt-2 grid grid-cols-1 gap-2 sm:grid-cols-3">
              ${kpi('timer','Packaging hours / mo (current)', round(r.appsInScope * r.avgUpdatesPerAppPerMonth * r.currentHrsPerPackage),'')}
              ${kpi('hammer','$ packaging labor / yr (current)', '$'+num(r.appsInScope * r.avgUpdatesPerAppPerMonth * r.currentHrsPerPackage * r.loadedHourlyRate * 12),'')}
              ${kpi('shield-alert','Risk window (days / yr, current)', round(r.criticalCVEsPerYear * r.currentDaysToPatchCritical,1),'')}
            </div>
          </div>

          <p class="text-xs text-[${BRAND.muted}]">Transparency: Recast AW complements device management (e.g., Intune). Windows/macOS focus. Metrics are illustrative; actuals vary.</p>
        </section>
      `;
    }

    // ---- Events & lifecycle --------------------------------------------------
    function attachGlobalEvents(){
      const root = document.getElementById('app');

      // Keyboard left/right to switch tabs
      const tabButtons = Array.from(root.querySelectorAll('[data-action="switch-tab"]'));
      if (tabButtons.length){
        const ids = TABS.map(t=>t.id);
        root.addEventListener('keydown', (e)=>{
          if (!['ArrowLeft','ArrowRight'].includes(e.key)) return;
          const idx = ids.indexOf(STATE.activeTab);
          const next = e.key==='ArrowRight' ? (idx+1)%ids.length : (idx-1+ids.length)%ids.length;
          STATE.activeTab = ids[next];
          track('scene_viewed', { scene: STATE.activeTab });
          if (STATE.activeTab === 'solution') track('funnel_step', { step: 'view_solution' });
          if (STATE.activeTab === 'roi') track('funnel_step', { step: 'view_roi' });
          render();
        });
      }

      root.querySelectorAll('[data-action="switch-tab"]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const next = e.currentTarget.getAttribute('data-tab');
          STATE.activeTab = next;
          track('scene_viewed', { scene: next });
          if (next === 'solution') track('funnel_step', { step: 'view_solution' });
          if (next === 'roi') track('funnel_step', { step: 'view_roi' });
          render();
        });
      });

      root.querySelectorAll('[data-action="advance"]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const next = e.currentTarget.getAttribute('data-next');
          STATE.activeTab = next;
          track('toggle_changed', { control: 'tab', value: next });
          track('scene_viewed', { scene: next });
          if (next === 'solution') track('funnel_step', { step: 'view_solution' });
          if (next === 'roi') track('funnel_step', { step: 'view_roi' });
          render();
        });
      });

      root.querySelectorAll('[data-action="set-device"]').forEach(btn=>{
        btn.addEventListener('click', e=>{
          STATE.ctx.device = e.currentTarget.getAttribute('data-value');
          track('toggle_changed', { control: 'device', value: STATE.ctx.device });
          render();
        });
      });
      root.querySelectorAll('[data-action="set-network"]').forEach(btn=>{
        btn.addEventListener('click', e=>{
          STATE.ctx.network = e.currentTarget.getAttribute('data-value');
          track('toggle_changed', { control: 'network', value: STATE.ctx.network });
          render();
        });
      });
      root.querySelectorAll('[data-action="toggle-compliance"]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          STATE.ctx.compliant = !STATE.ctx.compliant;
          track('toggle_changed', { control: 'compliant', value: STATE.ctx.compliant });
          render();
        });
      });

      root.querySelectorAll('[data-action="set-roi"]').forEach(inp=>{
        inp.addEventListener('input', (e)=>{
          const key = e.currentTarget.getAttribute('data-key');
          const v = Number(String(e.currentTarget.value).replace(/[^0-9.\-]/g,''));
          STATE.roi[key] = isFinite(v) ? v : 0;
        });
      });

      const resetBtn = root.querySelector('[data-action="reset-calculator"]');
      if (resetBtn) resetBtn.addEventListener('click', ()=>{
        STATE.roi = {
          appsInScope: 120,
          avgUpdatesPerAppPerMonth: 2,
          currentHrsPerPackage: 2.5,
          recastHrsPerCuratedUpdate: 0.25,
          loadedHourlyRate: 85,
          criticalCVEsPerYear: 6,
          currentDaysToPatchCritical: 9,
          withRingsDaysToPatch: 3,
          auditHoursPerQuarter: 8,
          withRecastAuditHoursPerQuarter: 0.75,
          recastAnnualCost: 120000,
          realizationPct: 85,
          monthsToValue: 12
        };
        track('cta_clicked', { cta: 'reset_calculator' });
        render();
      });

      const copyBtn = root.querySelector('[data-action="copy-onepager"]');
      if (copyBtn) copyBtn.addEventListener('click', async ()=>{
        const r = STATE.roi;

        const packagingHoursSavedPerMonth = clampNonNeg(r.appsInScope * r.avgUpdatesPerAppPerMonth * (r.currentHrsPerPackage - r.recastHrsPerCuratedUpdate));
        const packagingLaborSavedPerMonthDollars = packagingHoursSavedPerMonth * clampNonNeg(r.loadedHourlyRate);
        const riskWindowReductionDaysPerYear = clampNonNeg(r.criticalCVEsPerYear * (r.currentDaysToPatchCritical - r.withRingsDaysToPatch));
        const auditHoursSavedPerYear = clampNonNeg((r.auditHoursPerQuarter - r.withRecastAuditHoursPerQuarter) * 4);
        const auditEffortAvoidedPerYearDollars = auditHoursSavedPerYear * clampNonNeg(r.loadedHourlyRate);
        const totalSavingsPerYear = (packagingLaborSavedPerMonthDollars * 12) + auditEffortAvoidedPerYearDollars;

        const prob = clampNonNeg(r.realizationPct ?? 100) / 100;
        const prorate = Math.min(12, Math.max(0, r.monthsToValue ?? 12)) / 12;
        const adjTotalSavingsPerYear = totalSavingsPerYear * prob * prorate;
        const netBenefitYear = adjTotalSavingsPerYear - clampNonNeg(r.recastAnnualCost);
        const roiPct = r.recastAnnualCost ? (netBenefitYear / r.recastAnnualCost) * 100 : 0;

        const body =
`Recast Application Workspace — Executive One-Pager

Inputs (editable)
 - Apps in scope: ${r.appsInScope}
 - Avg updates per app / month: ${r.avgUpdatesPerAppPerMonth}
 - Current hrs per package/update: ${r.currentHrsPerPackage}
 - Recast hrs per curated update: ${r.recastHrsPerCuratedUpdate}
 - Loaded hourly rate: $${r.loadedHourlyRate}/hr
 - Critical CVEs / year: ${r.criticalCVEsPerYear}
 - Current days to patch critical: ${r.currentDaysToPatchCritical}
 - With rings: days to patch: ${r.withRingsDaysToPatch}
 - Audit hours / quarter: ${r.auditHoursPerQuarter}
 - With Recast audit hours / quarter: ${r.withRecastAuditHoursPerQuarter}
 - Recast annual cost: $${r.recastAnnualCost}
 - Probability to realize: ${r.realizationPct}%
 - Time-to-value (months, yr-1): ${r.monthsToValue}

Outputs
 - Packaging hours saved / month: ${round(packagingHoursSavedPerMonth)}
 - $ packaging labor saved / year: $${num(packagingLaborSavedPerMonthDollars * 12)}
 - Risk window reduction / year: ${round(riskWindowReductionDaysPerYear,1)} days
 - Audit hours avoided / year: ${round(auditHoursSavedPerYear)}
 - $ audit effort avoided / year: $${num(auditEffortAvoidedPerYearDollars)}
 - Total savings / year (adjusted): $${num2(adjTotalSavingsPerYear,2)}
 - Net benefit / year: $${num2(netBenefitYear,2)}
 - ROI (adjusted): ${round(roiPct,1)}%

Scope included: catalog & packaging, lifecycle rings, cross-platform reach, governance & evidence, identity & SSO, integrations, and scale signals.`;
        try { await navigator.clipboard.writeText(body); }
        catch {
          const ta = document.createElement('textarea'); ta.value = body;
          document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        }
        STATE.copied = true;
        track('cta_clicked', { cta: 'copy_onepager' });
        render();
        setTimeout(()=>{ STATE.copied = false; render(); }, 1200);
      });

      const whyBtn = root.querySelector('[data-action="toggle-why"]');
      if (whyBtn){
        whyBtn.addEventListener('click', ()=>{
          const box = root.querySelector('#why-route');
          if (!box) return;
          const hidden = box.classList.toggle('hidden');
          whyBtn.setAttribute('aria-expanded', String(!hidden));
        });
      }

      // Inline controls in Solution cards
      const packHrs = root.querySelector('[data-action="set-pack-hrs"]');
      if (packHrs) packHrs.addEventListener('input', e => { STATE.packHrs = clampNonNeg(e.currentTarget.value); });
      const configHrs = root.querySelector('[data-action="set-config-hrs"]');
      if (configHrs) configHrs.addEventListener('input', e => { STATE.configHrs = clampNonNeg(e.currentTarget.value); });
      const curHrs = root.querySelector('[data-action="set-current-hrs"]');
      if (curHrs) curHrs.addEventListener('input', e => { STATE.currentHrs = clampNonNeg(e.currentTarget.value); });
    }

    // ---- Boot ---------------------------------------------------------------
    document.addEventListener('DOMContentLoaded', ()=>{
      track('scene_viewed', { scene: STATE.activeTab });
      track('funnel_step', { step: 'view_problems' });
      render();
    });
  </script>
</body>
</html>
